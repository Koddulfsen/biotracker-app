<!DOCTYPE html>
<html>
<head>
    <title>Supabase Auth Test</title>
</head>
<body>
    <h1>Supabase Authentication Test</h1>
    <button onclick="testAuth()">Test Login</button>
    <pre id="output"></pre>

    <script>
        const SUPABASE_URL = 'https://pxmukjgzrchnlsukdegy.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB4bXVramd6cmNobmxzdWtkZWd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0MTkzNzYsImV4cCI6MjA2Nzk5NTM3Nn0.O31I8P53_4TyHvqPbAE87kDwcOgSpH2WfvGIzNnZxa0';
        
        const output = document.getElementById('output');
        
        function log(msg) {
            output.textContent += msg + '\n';
            console.log(msg);
        }
        
        async function testAuth() {
            log('Starting authentication test...');
            
            // Test 1: Basic fetch
            try {
                log('\nTest 1: Basic fetch to Supabase');
                const response = await fetch(SUPABASE_URL + '/auth/v1/health');
                log('Health check status: ' + response.status);
            } catch (e) {
                log('Health check error: ' + e.message);
            }
            
            // Test 2: Auth endpoint with credentials
            try {
                log('\nTest 2: Login with credentials');
                const authUrl = SUPABASE_URL + '/auth/v1/token?grant_type=password';
                log('URL: ' + authUrl);
                
                const body = JSON.stringify({
                    email: 'test@example.com',
                    password: 'testpassword'
                });
                log('Body: ' + body);
                
                const response = await fetch(authUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_ANON_KEY
                    },
                    body: body
                });
                
                log('Auth response status: ' + response.status);
                const data = await response.json();
                log('Auth response: ' + JSON.stringify(data, null, 2));
            } catch (e) {
                log('Auth error: ' + e.message);
                log('Error stack: ' + e.stack);
            }
            
            // Test 3: Check what causes invalid value error
            try {
                log('\nTest 3: Testing various fetch calls');
                
                // Test with undefined
                try {
                    await fetch(undefined);
                } catch (e) {
                    log('Undefined URL error: ' + e.message);
                }
                
                // Test with null
                try {
                    await fetch(null);
                } catch (e) {
                    log('Null URL error: ' + e.message);
                }
                
                // Test with empty string
                try {
                    await fetch('');
                } catch (e) {
                    log('Empty URL error: ' + e.message);
                }
                
            } catch (e) {
                log('Test 3 error: ' + e.message);
            }
        }
    </script>
</body>
</html>